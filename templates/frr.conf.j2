frr defaults traditional
log file /var/log/frr/frr.log
log timestamp precision 3
!
debug zebra nht
debug bgp neighbor-events
debug bgp nht
debug bgp updates in
debug bgp updates out
{% if metallb_bfd_enable %}
debug bfd peer
{% endif -%}

!
router bgp {{ metallb_aws_side_asn }}
 timers bgp 3 15
 no bgp ebgp-requires-policy
 no bgp default ipv4-unicast
 no bgp network import-check

 neighbor metallb peer-group
 neighbor metallb remote-as {{ metallb_openshift_side_asn }}
{% for frr_node in frr_nodes %}
 neighbor {{ frr_node }} peer-group metallb
{% if metallb_bfd_enable %}
 neighbor {{ frr_node }} bfd
{% endif %}
{% endfor %}
 address-family ipv4 unicast
{% for frr_node in frr_nodes %}
    neighbor {{ frr_node }} next-hop-self
    neighbor {{ frr_node }} activate
{% endfor %}
 exit-address-family
!
!
{% if metallb_bfd_enable %}
bfd
{% for frr_node in frr_nodes %}
 peer {{ frr_node }} multihop local-address {{ frr_local_ip }}
{% endfor %}
 exit
 !
exit
{% endif %}
